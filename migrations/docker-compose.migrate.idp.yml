version: '3.7'

services:

  idp-migrate:
    build:
      context: ../../idp
      dockerfile: Dockerfile.dev
    entrypoint: ""
    command:
      go run main.go --migrate
    networks:
      - lockdown
    environment:
      - CONFIG_DISCOVERY_PATH=/discovery.yml
      - CONFIG_APP_PATH=/app.yml
    volumes:
      - ../../idp/migrations:/go/src/github.com/opensentry/idp/migrations
      - ../config/discovery.yml:/discovery.yml
      - ../config/idp.yml:/app.yml
    #user: "1000"
    restart: "no"

networks:
  lockdown: # No external network allowed - used for storage services
    name: opensentry_lockdown
    internal: true
